const logger = require('logger.js')("Divine Pride API Module");
const request = require('request');
const link = "https://divine-pride.net/api/database";

async function getApiLink(message, args, apikey, type) {
  if (args.length === 0) {
    message.channel.send("Need to specify an id.");
    return;
  }

  args = args.length > 1 ? args[0] : args;

  if (isNaN(args)) {
    message.channel.send("Id needs to be an integer.");
    return;
  }
 
  logger.info(args);
  const url = `${link}/${type}/${args}?apikey=${apikey}`;
  await getJSONReply(url)
    .then(json => {
      const reply = JSON.stringify(json);
      logger.info(reply);
      message.channel.send(reply);
    })
    .catch(err => {
      logger.error(err);
      //message.channel.send(err);
    });
};

async function getJSONReply(url) {
  return new Promise((resolve, reject) => {
    const reply = request({
      url: url,
      json: true,
    }, function(error, response, body) {
      if (error || response.statusCode !== 200) {
        reject(new Error("An error occurred on request. Please try again."));
      }
      resolve(body);
    });
  });
}


module.exports = getApiLink;
