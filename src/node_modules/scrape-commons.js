// all scraping stuff
const logger = require('logger.js')("Scraping module");
const rp = require('request-promise').defaults({jar: true});
const cheerio = require('cheerio');
const dt = require('data-tables');
const config = require('../config.json');
const LINK = 'https://www.novaragnarok.com';

async function login() {
  const options = {
    method: 'POST',
    uri: LINK,
    qs: {
      module: 'account',
      action: 'login',
    },
    form: {
      username: config.novaUsername,
      password: config.novaPassword,
      server: 'NovaRO',
    },
    followAllRedirects: true,
  }
  rp(options)
    .then(res => {
      console.log(`Nova login successful!`);
    })
    .catch(err => {
      console.log(`An error occurred with Nova login: ${err}`);
    });
}

async function getPage(url, qs = {}) {

  const options = {
    method: 'GET',
    uri:    url,
    qs: qs,
    transform: (body) => {
      return cheerio.load(body);
    },
  };

  return rp(options)
    .then($ => {
      console.log($);
      return $;
    })
    .catch(err => {
      logger.error(`An error has occurred on request. ${err}`);
    });
}

exports.getPage = getPage;
exports.login = login;
